<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Collection Details - Sheeka</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            /* These will be set dynamically by JavaScript */
            --primary-color: #C8797D;
            --secondary-color: #A85F64;
            --tertiary-color: #FDF5E6;
            --general-text-color: #4A4A4A;
            --footer-bg-color: #4A4A4A;
            --footer-text-color: #DDCACA;
            --footer-link-color: #E6B89C;
            --hero-gradient-from: var(--primary-color);
            --hero-gradient-to: var(--secondary-color);
            --section-bg-primary: var(--tertiary-color);
            --section-bg-secondary: #F5F0F0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--tertiary-color); /* Creamy off-white */
            color: var(--general-text-color); /* Dark charcoal */
        }
        /* Dynamic colors applied using CSS variables */
        .text-primary { color: var(--primary-color); }
        .text-general { color: var(--general-text-color); }
        .bg-primary { background-color: var(--primary-color); }
        .bg-secondary { background-color: var(--secondary-color); }
        .bg-tertiary { background-color: var(--tertiary-color); }
        .hover\:text-primary:hover { color: var(--primary-color); }
        .hover\:bg-secondary:hover { background-color: var(--secondary-color); }
        .focus\:ring-primary:focus { ring-color: var(--primary-color); }
        .focus\:border-primary:focus { border-color: var(--primary-color); }
        
        .footer-bg { background-color: var(--footer-bg-color); }
        .footer-text { color: var(--footer-text-color); }
        .footer-link:hover { color: var(--footer-link-color); }

        /* Ensuring main content background adapts to primary section background color */
        main {
            background-color: var(--section-bg-primary);
        }
    </style>
</head>
<body class="overflow-x-hidden">
    <!-- Header -->
    <header class="bg-white shadow-sm py-4 fixed w-full z-50">
        <nav class="container mx-auto px-6 flex justify-between items-center">
            <a href="index.html" id="site-name-header" class="text-3xl font-extrabold text-primary rounded-lg p-2 hover:text-secondary transition duration-300"></a>
            <div class="hidden md:flex space-x-8">
                <!-- Navigation links pointing back to index.html -->
                <a href="index.html#hero" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">Home</a>
                <a href="index.html#products" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">Products</a>
                <a href="index.html#categories" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">Categories</a>
                <a href="index.html#about" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">About Us</a>
                <a href="index.html#contact" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">Contact</a>
            </div>
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden text-general hover:text-primary focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </nav>
        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu-overlay" class="hidden md:hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>
        <!-- Mobile Menu Sidebar -->
        <div id="mobile-menu" class="hidden md:hidden fixed inset-y-0 right-0 w-64 bg-white shadow-lg z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
            <div class="p-6">
                <button id="close-mobile-menu" class="absolute top-4 right-4 text-general hover:text-primary focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                <nav class="flex flex-col space-y-4 mt-8">
                    <a href="index.html#hero" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">Home</a>
                    <a href="index.html#products" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">Products</a>
                    <a href="index.html#categories" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">Categories</a>
                    <a href="index.html#about" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">About Us</a>
                    <a href="index.html#contact" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">Contact</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="pt-24 pb-16"> <!-- Padding-top to account for fixed header -->
        <div class="container mx-auto px-6">
            <h1 id="collection-title" class="text-5xl font-extrabold text-center mb-12 text-primary">Collection Name</h1>
            <div id="collection-products" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <p class="col-span-full text-center text-gray-500">Loading products in collection...</p>
            </div>
            <p id="error-message" class="col-span-full text-center text-red-500 mt-8 hidden"></p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer-bg text-white py-10">
        <div class="container mx-auto px-6 text-center">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div>
                    <h3 class="text-xl font-bold mb-4" id="footer-site-name"></h3>
                    <p class="footer-text" id="footer-slogan"></p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="index.html#products" class="footer-text hover:footer-link transition duration-300">Products</a></li>
                        <li><a href="index.html#categories" class="footer-text hover:footer-link transition duration-300">Categories</a></li>
                        <li><a href="index.html#about" class="footer-text hover:footer-link transition duration-300">About Us</a></li>
                        <li><a href="index.html#contact" class="footer-text hover:footer-link transition duration-300">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Connect With Us</h3>
                    <div class="flex justify-center space-x-4" id="social-media-links">
                        <!-- Social media icons will be dynamically loaded here -->
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-8 mt-8">
                <p class="footer-text" id="copyright-site-name-footer"></p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const BASE_URL = 'https://sheeka.onrender.com';
            const collectionTitle = document.getElementById('collection-title');
            const collectionProductsContainer = document.getElementById('collection-products');
            const errorMessage = document.getElementById('error-message');

            // DOM elements for dynamic site config
            const pageTitleElem = document.getElementById('page-title');
            const siteNameHeader = document.getElementById('site-name-header');
            const footerSiteName = document.getElementById('footer-site-name');
            const footerSlogan = document.getElementById('footer-slogan');
            const copyrightSiteNameFooter = document.getElementById('copyright-site-name-footer');
            const socialMediaLinksContainer = document.getElementById('social-media-links');

            // Mobile menu toggle logic
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

            function openMobileMenu() {
                mobileMenu.classList.remove('translate-x-full');
                mobileMenu.classList.add('translate-x-0');
                mobileMenu.classList.remove('hidden');
                mobileMenuOverlay.classList.remove('hidden');
            }

            function closeMobileMenu() {
                mobileMenu.classList.remove('translate-x-0');
                mobileMenu.classList.add('translate-x-full');
                mobileMenuOverlay.classList.add('hidden');
                setTimeout(() => {
                    mobileMenu.classList.add('hidden');
                }, 300);
            }

            mobileMenuButton.addEventListener('click', openMobileMenu);
            closeMobileMenuButton.addEventListener('click', closeMobileMenu);
            mobileMenuOverlay.addEventListener('click', closeMobileMenu);

            // Helper function to get query parameter
            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }

            // Helper function to build absolute image URLs
            function buildAbsoluteImageUrl(url) {
                if (!url) return 'https://placehold.co/600x400/EEEEEE/333333?text=No+Image';
                if (url.startsWith('http')) return url; // Already absolute
                return `${BASE_URL}${url}`;
            }

            // Define multiple design configurations (same as index.html for consistency)
            const designConfigurations = [
                {   // Design 0: Original Sheeka Pink (Default layout)
                    name: 'Default Sheeka Pink',
                    primaryColor: '#C8797D',
                    secondaryColor: '#A85F64',
                    tertiaryColor: '#FDF5E6',
                    generalTextColor: '#4A4A4A',
                    footerBgColor: '#4A4A4A',
                    footerTextColor: '#DDCACA',
                    footerLinkColor: '#E6B89C',
                    sectionBgPrimary: '#FDF5E6',
                    sectionBgSecondary: '#F5F0F0',
                },
                {   // Design 1: Ocean Breeze
                    name: 'Ocean Breeze',
                    primaryColor: '#4A90E2', // Sky Blue
                    secondaryColor: '#2E86AB', // Deep Blue
                    tertiaryColor: '#E0F2F7', // Light Cyan
                    generalTextColor: '#2C3E50', // Dark Blue-Grey
                    footerBgColor: '#2E86AB',
                    footerTextColor: '#A2D9CE',
                    footerLinkColor: '#F0F8FF',
                    sectionBgPrimary: '#E0F2F7',
                    sectionBgSecondary: '#D1EEF5',
                },
                {   // Design 2: Forest Earth
                    name: 'Forest Earth',
                    primaryColor: '#6A994E', // Forest Green
                    secondaryColor: '#386641', // Dark Green
                    tertiaryColor: '#F2EFE8', // Off-white/Beige
                    generalTextColor: '#4F4631', // Dark Brown-Green
                    footerBgColor: '#386641',
                    footerTextColor: '#D9E8D0',
                    footerLinkColor: '#F7F7E0',
                    sectionBgPrimary: '#F2EFE8',
                    sectionBgSecondary: '#E8E4DB',
                },
                {   // Design 3: Modern Monochrome
                    name: 'Modern Monochrome',
                    primaryColor: '#FF6B6B', // Coral Red Accent
                    secondaryColor: '#343A40', // Dark Grey
                    tertiaryColor: '#F8F9FA', // Light Grey
                    generalTextColor: '#212529', // Blackish-Grey
                    footerBgColor: '#212529',
                    footerTextColor: '#CED4DA',
                    footerLinkColor: '#FF6B6B',
                    sectionBgPrimary: '#F8F9FA',
                    sectionBgSecondary: '#E9ECEF',
                },
                {   // Design 4: Royal Purple & Gold
                    name: 'Royal Purple & Gold',
                    primaryColor: '#8A2BE2', // Blue Violet (Purple)
                    secondaryColor: '#6A0DAD', // Darker Purple
                    tertiaryColor: '#FFFACD', // Lemon Chiffon (Light Yellow/Cream)
                    generalTextColor: '#36013F', // Deep Purple-Black
                    footerBgColor: '#6A0DAD',
                    footerTextColor: '#DAA520', // Goldenrod
                    footerLinkColor: '#FFD700', // Gold
                    sectionBgPrimary: '#FFFACD',
                    sectionBgSecondary: '#F8E7D1',
                },
                {   // Design 5: Warm Sunset
                    name: 'Warm Sunset',
                    primaryColor: '#FF7F50', // Coral
                    secondaryColor: '#FF4500', // Orange Red
                    tertiaryColor: '#FFF8DC', // Cornsilk (Very light yellow)
                    generalTextColor: '#8B4513', // Saddle Brown
                    footerBgColor: '#FF4500',
                    footerTextColor: '#FFDEAD', // Navajo White
                    footerLinkColor: '#FFA07A', // Light Salmon
                    sectionBgPrimary: '#FFF8DC',
                    sectionBgSecondary: '#F5DEB3',
                }
            ];

            // Function to apply a specific design based on index
            function applyDesign(designIndex, siteConfig) {
                const root = document.documentElement;
                const chosenDesign = designConfigurations[designIndex];

                if (!chosenDesign) {
                    console.warn(`Design index ${designIndex} not found. Applying default design (index 0).`);
                    applyDesign(0, siteConfig); // Fallback to default design
                    return;
                }

                // Apply colors
                root.style.setProperty('--primary-color', chosenDesign.primaryColor);
                root.style.setProperty('--secondary-color', chosenDesign.secondaryColor);
                root.style.setProperty('--tertiary-color', chosenDesign.tertiaryColor);
                root.style.setProperty('--general-text-color', chosenDesign.generalTextColor);
                root.style.setProperty('--footer-bg-color', chosenDesign.footerBgColor);
                root.style.setProperty('--footer-text-color', chosenDesign.footerTextColor);
                root.style.setProperty('--footer-link-color', chosenDesign.footerLinkColor);
                root.style.setProperty('--section-bg-primary', chosenDesign.sectionBgPrimary);
                root.style.setProperty('--section-bg-secondary', chosenDesign.sectionBgSecondary);

                // Apply dynamic site info
                if (pageTitleElem) pageTitleElem.textContent = `${siteConfig.siteName} - Collection Details`; // Updated page title for consistency
                if (siteNameHeader) siteNameHeader.textContent = siteConfig.siteName;
                if (footerSiteName) footerSiteName.textContent = siteConfig.siteName;
                if (footerSlogan) footerSlogan.textContent = siteConfig.slogan;
                if (copyrightSiteNameFooter) copyrightSiteNameFooter.textContent = `Â© 2025 ${siteConfig.siteName}. All rights reserved.`;
                
                // Apply social media links
                if (socialMediaLinksContainer) {
                    socialMediaLinksContainer.innerHTML = ''; // Clear existing
                    if (siteConfig.socialMediaLinks && Array.isArray(siteConfig.socialMediaLinks)) {
                        siteConfig.socialMediaLinks.forEach(link => {
                            const a = document.createElement('a');
                            a.href = link.url;
                            a.target = '_blank'; // Open in new tab
                            // Use text-footer-text for social media icons for dynamic coloring
                            a.className = 'text-footer-text hover:text-white transition duration-300';
                            a.innerHTML = `<i class="${link.iconClass} w-6 h-6"></i>`;
                            socialMediaLinksContainer.appendChild(a);
                        });
                    }
                }
            }

            // Function to fetch and apply site configuration
            async function fetchSiteConfig() {
                try {
                    const response = await fetch(`${BASE_URL}/api/site-config`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const config = await response.json();
                    console.log("Fetched Site Config:", config);

                    // Determine the design index, fallback to 0 if invalid
                    const designIndex = (config.currentDataIndex !== undefined && config.currentDataIndex >= 0 && config.currentDataIndex < designConfigurations.length)
                        ? config.currentDataIndex
                        : 0; 
                    
                    // Apply the chosen design and populate relevant text fields
                    applyDesign(designIndex, config);

                } catch (error) {
                    console.error("Error fetching site configuration:", error);
                    // Fallback to default design and minimal content on error
                    applyDesign(0, { siteName: 'Sheeka', slogan: 'Elevate Your Style', socialMediaLinks: [] });
                    console.warn("Using default site configuration due to fetch error in collection-details.");
                }
            }


            const collectionId = getQueryParam('id');

            if (!collectionId) {
                collectionTitle.textContent = 'Error: Collection ID Missing';
                collectionProductsContainer.innerHTML = '';
                errorMessage.textContent = 'No collection ID provided in the URL.';
                errorMessage.classList.remove('hidden');
                return;
            }

            try {
                // Fetch collection details including populated products
                const response = await fetch(`${BASE_URL}/products/collections/${collectionId}`);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }
                const collection = await response.json();

                collectionTitle.textContent = collection.name || 'Untitled Collection';
                collectionProductsContainer.innerHTML = ''; // Clear loading message

                if (collection.productIds && collection.productIds.length > 0) {
                    collection.productIds.forEach(product => {
                        // Ensure product object is not null/undefined before accessing properties
                        if (!product || !product._id) {
                            console.warn('Skipping invalid product in collection:', product);
                            return;
                        }

                        const imageUrl = product.images && product.images.length > 0 
                            ? product.images[0] 
                            : 'https://placehold.co/600x400/EEEEEE/333333?text=No+Image';

                        const productCard = document.createElement('div');
                        productCard.className = 'bg-white rounded-xl shadow-lg overflow-hidden transform transition duration-300 hover:scale-105';
                        productCard.innerHTML = `
                            <a href="product-details.html?id=${product._id}" class="block">
                                <img src="${buildAbsoluteImageUrl(imageUrl)}" alt="${product.name}" class="w-full h-64 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/EEEEEE/333333?text=Image+Error';">
                                <div class="p-6">
                                    <h3 class="text-xl font-semibold mb-2 text-general">${product.name}</h3>
                                    <p class="text-gray-600 mb-4">${product.description?.substring(0, 100) ?? ''}${product.description?.length > 100 ? '...' : ''}</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-2xl font-bold text-primary">${parseFloat(product.price).toFixed(2)} DZD</span>
                                    </div>
                                </div>
                            </a>
                        `;
                        collectionProductsContainer.appendChild(productCard);
                    });
                } else {
                    collectionProductsContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">No products found in this collection.</p>';
                }

            } catch (error) {
                console.error("Error fetching collection details:", error);
                collectionTitle.textContent = 'Error Loading Collection';
                collectionProductsContainer.innerHTML = '';
                errorMessage.textContent = `Failed to load collection: ${error.message}`;
                errorMessage.classList.remove('hidden');
            }

            // Fetch and apply site configuration on page load
            fetchSiteConfig();
        });
    </script>
</body>
</html>
