<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title"></title>
    <!-- Meta description for SEO, will be dynamically updated by JS -->
    <meta name="description" id="meta-description" content="Découvrez les dernières tendances et les classiques intemporels chez Sheeka Store.">
    
    <!-- Security Headers (Best Practices) -->
    <!-- X-Frame-Options: DENY to prevent clickjacking -->
    <meta http-equiv="X-Frame-Options" content="DENY">
    <!-- Cross-Origin-Opener-Policy: same-origin for isolation -->
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <!-- Content-Security-Policy: Basic policy to prevent XSS. Adjust as needed for your specific resources. -->
    <!-- NOTE: 'unsafe-inline' is used for style-src and script-src because the CSS and JavaScript are embedded directly in this HTML file.
        For a more robust CSP in a production environment with external files, 'unsafe-inline' should be avoided. -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.tailwindcss.com https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://placehold.co https://sheeka.onrender.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.tailwindcss.com; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; img-src 'self' data: https://placehold.co https://res.cloudinary.com; media-src 'self' https://www.w3schools.com;">
    
    <!-- Preconnect for faster loading of critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://placehold.co">
    <link rel="preconnect" href="https://sheeka.onrender.com">

    <!-- Preload critical fonts for faster LCP -->
    <link rel="preload" href="https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5.woff2" as="font" type="font/woff2" crossorigin>

    <!-- Tailwind CSS CDN - using defer to not block rendering -->
    <script src="https://cdn.tailwindcss.com" defer></script>
    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons - using defer to not block rendering -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" defer>
    <style>
        :root {
            /* These will be set dynamically by JavaScript */
            --primary-color: #C8797D;
            --secondary-color: #A85F64;
            --tertiary-color: #FDF5E6;
            --general-text-color: #4A4A4A;
            --footer-bg-color: #4A4A4A;
            --footer-text-color: #DDCACA;
            --footer-link-color: #E6B89C;
            --hero-gradient-from: var(--primary-color);
            --hero-gradient-to: var(--secondary-color);
            --section-bg-primary: var(--tertiary-color); /* for products/about sections */
            --section-bg-secondary: #F5F0F0; /* for categories/contact sections */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--tertiary-color); /* Creamy off-white */
            color: var(--general-text-color); /* Dark charcoal */
        }
        .section-fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .section-fade-in.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        .animate-slide-in-left {
            animation: slideInLeft 1s ease-out forwards;
        }
        .animate-slide-in-right {
            animation: slideInRight 1s ease-out forwards;
        }
        .animate-fade-in {
            animation: fadeIn 1.5s ease-out forwards;
        }
        /* Added for smooth background image transitions */
        #hero-background {
            transition: background-image 1s ease-in-out; /* Removed opacity transition as it's now opaque */
        }

        /* Dynamic colors applied using CSS variables */
        .text-primary { color: var(--primary-color); }
        .text-general { color: var(--general-text-color); }
        .bg-primary { background-color: var(--primary-color); }
        .bg-secondary { background-color: var(--secondary-color); }
        .bg-tertiary { background-color: var(--tertiary-color); }
        .hover\:text-primary:hover { color: var(--primary-color); }
        .hover\:bg-secondary:hover { background-color: var(--secondary-color); }
        .focus\:ring-primary:focus { ring-color: var(--primary-color); }
        .focus\:border-primary:focus { border-color: var(--primary-color); }
        
        .footer-bg { background-color: var(--footer-bg-color); }
        .footer-text { color: var(--footer-text-color); }
        .footer-link:hover { color: var(--footer-link-color); }

        /* No direct gradient on #hero anymore, it's on the overlay div */
        /* Dynamic section backgrounds */
        #products, #about {
            background-color: var(--section-bg-primary);
        }
        #categories, #contact {
            background-color: var(--section-bg-secondary);
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>
    <!-- Schema.org Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Sheeka Store",
      "url": "https://sheeka.onrender.com",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://sheeka.onrender.com/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Sheeka Store",
      "url": "https://sheeka.onrender.com",
      "logo": "https://placehold.co/150x50/C8797D/FFFFFF?text=SheekaLogo",
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+213-555-1234",
        "contactType": "Customer Service"
      },
      "sameAs": [
        "https://www.facebook.com/sheekastore",
        "https://www.instagram.com/sheekastore",
        "https://www.twitter.com/sheekastore"
      ]
    }
    </script>
</head>
<body class="overflow-x-hidden">
    <!-- Header -->
    <header class="bg-white shadow-sm py-4 fixed w-full z-50">
        <nav class="container mx-auto px-6 flex justify-between items-center">
            <a href="index.html" id="site-name-header" class="text-3xl font-extrabold text-primary rounded-lg p-2 hover:text-secondary transition duration-300"></a>
            <div class="hidden md:flex space-x-8">
                <!-- Navigation links pointing back to index.html with section IDs -->
                <a href="index.html#hero" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">Home</a>
                <a href="index.html#products" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">Products</a>
                <a href="index.html#categories" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">Categories</a>
                <a href="index.html#about" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">About Us</a>
                <a href="index.html#contact" class="text-general hover:text-primary font-medium transition duration-300 rounded-md p-2">Contact</a>
            </div>
            <!-- Mobile Menu Button - Added aria-label for accessibility -->
            <button id="mobile-menu-button" class="md:hidden text-general hover:text-primary focus:outline-none" aria-label="Open mobile menu">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </nav>
        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu-overlay" class="hidden md:hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>
        <!-- Mobile Menu Sidebar -->
        <div id="mobile-menu" class="hidden md:hidden fixed inset-y-0 right-0 w-64 bg-white shadow-lg z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
            <div class="p-6">
                <!-- Close Mobile Menu Button - Added aria-label for accessibility -->
                <button id="close-mobile-menu" class="absolute top-4 right-4 text-general hover:text-primary focus:outline-none" aria-label="Close mobile menu">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                <nav class="flex flex-col space-y-4 mt-8">
                    <a href="index.html#hero" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">Home</a>
                    <a href="index.html#products" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">Products</a>
                    <a href="index.html#categories" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">Categories</a>
                    <a href="index.html#about" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">About Us</a>
                    <a href="index.html#contact" class="text-gray-800 hover:text-primary font-medium text-lg rounded-md p-2" onclick="closeMobileMenu()">Contact</a>
                </nav>
            </div>
        </div>
    </header>

    <main id="main-content-container">
        <!-- Hero Section -->
        <section id="hero" class="relative text-white h-screen flex items-center justify-center text-center overflow-hidden pt-16">
            <!-- Background media container - now fully opaque, transition handled by JS for image/video swap -->
            <div id="hero-media-container" class="absolute inset-0 z-0">
                <div id="hero-background" class="absolute inset-0 w-full h-full bg-cover bg-center transition-all duration-1000 ease-in-out"></div>
                <video id="hero-video-background" class="absolute inset-0 w-full h-full object-cover hidden" loop muted autoplay playsinline>
                    <source id="hero-video-source" src="" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            <!-- Gradient Overlay - now a separate div with controlled opacity -->
            <div class="absolute inset-0 z-10" style="background-image: linear-gradient(to right, var(--hero-gradient-from), var(--hero-gradient-to)); opacity: 0.8;"></div>
            
            <!-- Dynamic Content Container -->
            <div id="hero-dynamic-content" class="relative z-20 p-8 max-w-4xl mx-auto">
                <!-- Content will be injected here by JavaScript based on design -->
                <!-- Default content (Design 0) -->
                <h1 class="text-5xl md:text-7xl font-extrabold mb-6 leading-tight animate-fade-in">
                    <span id="hero-site-name"></span>: <span class="block text-[#E6B89C]" id="hero-slogan"></span>
                </h1>
                <p class="text-lg md:text-xl mb-10 opacity-0 animate-slide-in-right" style="animation-delay: 0.5s;">
                    Discover the latest trends and timeless classics that define sophistication and comfort.
                </p>
                <a href="#products" class="inline-block bg-white text-primary hover:bg-gray-100 px-10 py-4 rounded-full text-lg font-semibold shadow-xl transition duration-300 transform hover:scale-105 opacity-0 animate-slide-in-left" aria-label="Shop Now">
                    Shop Now
                </a>
            </div>
        </section>

        <!-- Featured Products Section -->
        <section id="products" class="py-16 section-fade-in">
            <div class="container mx-auto px-6">
                <h2 id="products-section-title" class="text-4xl font-bold text-center mb-12 text-general">Featured Products</h2>
                <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Products will be dynamically loaded here by JavaScript -->
                    <p class="col-span-full text-center text-gray-500">Loading products...</p>
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section id="categories" class="py-16 section-fade-in">
            <div class="container mx-auto px-6">
                <h2 id="categories-section-title" class="text-4xl font-bold text-center mb-12 text-general">Shop by Category</h2>
                <div id="category-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Categories will be dynamically loaded here by JavaScript -->
                    <p class="col-span-full text-center text-gray-500">Loading categories...</p>
                </div>
            </div>
        </section>

        <!-- About Us Section -->
        <section id="about" class="py-16 section-fade-in">
            <div class="container mx-auto px-6 flex flex-col lg:flex-row items-center gap-12">
                <div class="lg:w-1/2">
                    <!-- Added loading="lazy" for performance and explicit width/height for CLS -->
                    <img id="about-us-image" src="https://placehold.co/800x600/6A5ACD/FFFFFF?text=About+Sheeka" alt="À propos de Sheeka Store" class="rounded-xl shadow-xl w-full h-auto object-cover transform transition duration-500 hover:scale-105" loading="lazy" width="800" height="600">
                </div>
                <div class="lg:w-1/2 text-center lg:text-left">
                    <h2 class="text-4xl font-bold mb-6 text-general">About Us</h2>
                    <p class="text-lg text-general mb-4 leading-relaxed" id="about-us-text"></p>
                </div>
            </div>
        </section>

        <!-- Call to Action / Newsletter Section -->
        <section id="newsletter" class="py-16 bg-gradient-to-r from-secondary to-primary text-white text-center section-fade-in">
            <div class="container mx-auto px-6">
                <h2 class="text-4xl font-bold mb-6">Stay Updated with <span id="newsletter-site-name"></span>!</h2>
                <p class="text-xl mb-8 opacity-90">
                    Sign up for our newsletter to get exclusive offers, new arrivals, and style tips directly to your inbox.
                </p>
                <form class="max-w-md mx-auto flex flex-col sm:flex-row gap-4">
                    <input type="email" placeholder="Your email address" class="flex-grow p-4 rounded-full text-gray-900 focus:outline-none focus:ring-2 focus:ring-white focus:border-transparent transition duration-300 shadow-md" required aria-label="Your email address for newsletter">
                    <button type="submit" class="bg-white text-primary px-8 py-4 rounded-full font-semibold hover:bg-gray-100 transition duration-300 shadow-lg transform hover:scale-105">
                        Subscribe
                    </button>
                </form>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-16 section-fade-in">
            <div class="container mx-auto px-6">
                <h2 class="text-4xl font-bold text-center mb-12 text-general">Get in Touch</h2>
                <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-xl">
                    <form id="contact-form" class="space-y-6">
                        <div>
                            <label for="name" class="block text-lg font-medium text-general mb-2">Name</label>
                            <input type="text" id="name" name="name" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-300" placeholder="Your Name" required>
                        </div>
                        <div>
                            <label for="email" class="block text-lg font-medium text-general mb-2">Email</label>
                            <input type="email" id="email" name="email" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-300" placeholder="your@example.com" required>
                        </div>
                        <div>
                            <label for="message" class="block text-lg font-medium text-general mb-2">Message</label>
                            <textarea id="message" name="message" rows="6" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-300" placeholder="Your message here..." required></textarea>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="bg-primary text-white px-8 py-4 rounded-full font-semibold hover:bg-secondary transition duration-300 shadow-lg transform hover:scale-105">
                                Send Message
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer-bg text-white py-10">
        <div class="container mx-auto px-6 text-center">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div>
                    <h3 class="text-xl font-bold mb-4" id="footer-site-name"></h3>
                    <p class="footer-text" id="footer-slogan"></p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="index.html#products" class="footer-text hover:footer-link transition duration-300">Products</a></li>
                        <li><a href="index.html#categories" class="footer-text hover:footer-link transition duration-300">Categories</a></li>
                        <li><a href="index.html#about" class="footer-text hover:footer-link transition duration-300">About Us</a></li>
                        <li><a href="index.html#contact" class="footer-text hover:footer-link transition duration-300">Contact</a></li>
                        <!-- Added link to the policy page -->
                        <li><a href="privacy-policy.html" class="footer-text hover:footer-link transition duration-300">Politique de Commandes</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Connect With Us</h3>
                    <div class="flex justify-center space-x-4" id="social-media-links">
                        <!-- Social media icons will be dynamically loaded here -->
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-8 mt-8">
                <p class="footer-text">&copy; 2025 <span id="copyright-site-name"></span>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Message boxes for user feedback -->
    <div id="success-message-box" class="fixed bottom-8 right-8 bg-green-500 text-white px-6 py-3 rounded-lg shadow-xl hidden z-50">
        <!-- Success message here -->
    </div>
    <div id="error-message-box" class="fixed bottom-8 right-8 bg-red-500 text-white px-6 py-3 rounded-lg shadow-xl hidden z-50">
        <!-- Error message here -->
    </div>

    <!-- Cookie Consent Bar -->
    <div id="cookie-consent-bar" class="fixed bottom-0 left-0 right-0 bg-gray-800 text-white p-4 flex flex-col sm:flex-row items-center justify-between transform translate-y-full transition-transform duration-500 ease-out z-50">
        <p class="text-sm text-center sm:text-left mb-3 sm:mb-0">
            We use cookies to ensure you get the best experience on our website. By continuing to use this site, you agree to our <a href="privacy-policy.html" class="underline hover:text-blue-300">privacy policy</a>.
        </p>
        <div class="flex space-x-3">
            <button id="accept-cookies" class="bg-primary hover:bg-secondary text-white px-5 py-2 rounded-full text-sm font-semibold transition duration-300">
                Accept
            </button>
            <button id="decline-cookies" class="bg-gray-600 hover:bg-gray-700 text-white px-5 py-2 rounded-full text-sm font-semibold transition duration-300">
                Decline
            </button>
        </div>
    </div>

    <script>
        // Store the active design configuration globally for easy access
        let currentActiveDesign = null;

        document.addEventListener('DOMContentLoaded', () => {
            // Base URL for your backend API
            const BASE_URL = 'https://sheeka.onrender.com';

            // DOM elements
            const pageTitle = document.getElementById('page-title');
            const metaDescription = document.getElementById('meta-description'); // Get meta description element
            const siteNameHeader = document.getElementById('site-name-header');
            const aboutUsTextElem = document.getElementById('about-us-text');
            const aboutUsImageElem = document.getElementById('about-us-image'); 
            const newsletterSiteName = document.getElementById('newsletter-site-name');
            const footerSiteName = document.getElementById('footer-site-name');
            const footerSlogan = document.getElementById('footer-slogan');
            const copyrightSiteName = document.getElementById('copyright-site-name');
            const socialMediaLinksContainer = document.getElementById('social-media-links');

            const productListContainer = document.getElementById('product-list');
            const categoriesSectionTitle = document.getElementById('categories-section-title');
            const productsSectionTitle = document.getElementById('products-section-title');
            const categoryListContainer = document.getElementById('category-list');
            const heroMediaContainer = document.getElementById('hero-media-container'); // New container for background media
            const heroBackground = document.getElementById('hero-background');
            const heroVideoBackground = document.getElementById('hero-video-background');
            const heroVideoSource = document.getElementById('hero-video-source');
            const heroDynamicContent = document.getElementById('hero-dynamic-content');
            const mainContentContainer = document.getElementById('main-content-container'); // Added for reordering sections

            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            const fadeInSections = document.querySelectorAll('.section-fade-in');

            // Message box elements
            const successMessageBox = document.getElementById('success-message-box');
            const errorMessageBox = document.getElementById('error-message-box');

            // Cookie Consent elements
            const cookieConsentBar = document.getElementById('cookie-consent-bar');
            const acceptCookiesButton = document.getElementById('accept-cookies');
            const declineCookiesButton = document.getElementById('decline-cookies');

            // Variables for hero image carousel
            let promoImagesArray = [];
            let currentPromoImageIndex = 0;
            let heroImageInterval;

            // Define multiple design configurations
            const designConfigurations = [
                { 
                    name: 'Default Sheeka Pink',
                    layoutType: 'default', 
                    primaryColor: '#C8797D',
                    secondaryColor: '#A85F64',
                    tertiaryColor: '#FDF5E6',
                    generalTextColor: '#4A4A4A',
                    footerBgColor: '#4A4A4A',
                    footerTextColor: '#DDCACA',
                    footerLinkColor: '#E6B89C',
                    heroGradientFrom: '#C8797D',
                    heroGradientTo: '#A85F64',
                    sectionBgPrimary: '#FDF5E6',
                    sectionBgSecondary: '#F5F0F0',
                    heroDefaultImage: 'https://placehold.co/1920x1080/c7c7c7/ffffff?text=SHEEKA+COLLECTION+DEFAULT',
                    productSectionTitle: 'Featured Products', 
                    categorySectionTitle: 'Shop by Category',
                    // Default section order
                    sectionOrder: ['hero', 'products', 'categories', 'about', 'newsletter', 'contact'],
                    defaultMetaDescription: 'Découvrez les dernières tendances et les classiques intemporels chez Sheeka Store. Élégance et confort garantis.'
                },
                { 
                    name: 'Ocean Breeze',
                    layoutType: 'banner', 
                    primaryColor: '#4A90E2', // Sky Blue
                    secondaryColor: '#2E86AB', // Deep Blue
                    tertiaryColor: '#E0F2F7', // Light Cyan
                    generalTextColor: '#2C3E50', // Dark Blue-Grey
                    footerBgColor: '#2E86AB',
                    footerTextColor: '#A2D9CE',
                    footerLinkColor: '#F0F8FF',
                    heroGradientFrom: '#4A90E2',
                    heroGradientTo: '#2E86AB',
                    sectionBgPrimary: '#E0F2F7',
                    sectionBgSecondary: '#D1EEF5',
                    heroDefaultImage: 'https://placehold.co/1920x1080/A2CCB6/2E86AB?text=OCEAN+BREEZE+COLLECTION',
                    defaultBannerHeadline: 'Experience Serenity in Every Stitch.', 
                    productSectionTitle: 'Our Curated Picks', 
                    categorySectionTitle: 'Explore Unique Themes',
                    // Reordered sections: Categories first, then products
                    sectionOrder: ['hero', 'categories', 'products', 'newsletter', 'about', 'contact'],
                    defaultMetaDescription: 'Explorez la collection Ocean Breeze de Sheeka Store. Des vêtements qui allient sérénité et style pour une expérience unique.'
                },
                { 
                    name: 'Forest Earth',
                    layoutType: 'default', // Changed from 'video' to 'default'
                    primaryColor: '#6A994E', // Forest Green
                    secondaryColor: '#386641', // Dark Green
                    tertiaryColor: '#F2EFE8', // Off-white/Beige
                    generalTextColor: '#4F4631', // Dark Brown-Green
                    footerBgColor: '#386641',
                    footerTextColor: '#D9E8D0',
                    footerLinkColor: '#F7F7E0',
                    heroGradientFrom: '#6A994E',
                    heroGradientTo: '#386641',
                    sectionBgPrimary: '#F2EFE8',
                    sectionBgSecondary: '#E8E4DB',
                    heroDefaultImage: 'https://placehold.co/1920x1080/8B4513/FFFFFF?text=FOREST+EARTH+COLLECTION', // This image will now be used
                    // Removed defaultHeroVideoUrl
                    productSectionTitle: 'Handpicked for Nature Lovers', 
                    categorySectionTitle: 'Collections from the Wild',
                    // Different order: About Us after hero, then products & categories
                    sectionOrder: ['hero', 'about', 'products', 'categories', 'contact', 'newsletter'],
                    defaultMetaDescription: 'Découvrez la collection Forest Earth de Sheeka Store. Des pièces inspirées par la nature pour un style authentique et confortable.'
                },
                { 
                    name: 'Modern Monochrome',
                    layoutType: 'default',
                    primaryColor: '#495057', // Dark Grey (adjusted for contrast)
                    secondaryColor: '#212529', // Even Darker Grey (adjusted for contrast)
                    tertiaryColor: '#F8F9FA', // Light Grey
                    generalTextColor: '#212129', // Blackish-Grey
                    footerBgColor: '#212529',
                    footerTextColor: '#CED4DA',
                    footerLinkColor: '#FF6B6B', // Accent color for links
                    heroGradientFrom: '#495057',
                    heroGradientTo: '#212529',
                    sectionBgPrimary: '#F8F9FA',
                    sectionBgSecondary: '#E9ECEF',
                    heroDefaultImage: 'https://placehold.co/1920x1080/495057/FFFFFF?text=MONOCHROME+ELEGANCE',
                    productSectionTitle: 'Sleek & Stylish Products',
                    categorySectionTitle: 'Minimalist Collections',
                    // Order emphasizing contact and newsletter earlier
                    sectionOrder: ['hero', 'newsletter', 'products', 'categories', 'about', 'contact'],
                    defaultMetaDescription: 'Explorez le style épuré et moderne de la collection Monochrome de Sheeka Store. L\'élégance dans la simplicité.'
                },
                { 
                    name: 'Royal Purple & Gold',
                    layoutType: 'default',
                    primaryColor: '#8A2BE2', // Blue Violet (Purple)
                    secondaryColor: '#6A0DAD', // Darker Purple
                    tertiaryColor: '#FFFACD', // Lemon Chiffon (Light Yellow/Cream)
                    generalTextColor: '#36013F', // Deep Purple-Black
                    footerBgColor: '#6A0DAD',
                    footerTextColor: '#DAA520', // Goldenrod
                    footerLinkColor: '#FFD700', // Gold
                    heroGradientFrom: '#8A2BE2',
                    heroGradientTo: '#6A0DAD',
                    sectionBgPrimary: '#FFFACD',
                    sectionBgSecondary: '#F8E7D1',
                    heroDefaultImage: 'https://placehold.co/1920x1080/5C2D91/FFD700?text=ROYAL+COLLECTION',
                    productSectionTitle: 'Regal Selections',
                    categorySectionTitle: 'Opulent Collections',
                    // Another custom order
                    sectionOrder: ['hero', 'about', 'newsletter', 'products', 'categories', 'contact'],
                    defaultMetaDescription: 'Plongez dans le luxe avec la collection Royal Purple & Gold de Sheeka Store. Des pièces opulentes pour un style majestueux.'
                },
                { 
                    name: 'Warm Sunset',
                    layoutType: 'default',
                    primaryColor: '#E67E22', // Carrot Orange (adjusted for contrast)
                    secondaryColor: '#D35400', // Pumpkin Orange (adjusted for contrast)
                    tertiaryColor: '#FFF8DC', // Cornsilk (Very light yellow)
                    generalTextColor: '#8B4513', // Saddle Brown
                    footerBgColor: '#D35400', // Adjusted to match darker secondary
                    footerTextColor: '#FAD7A0', // Lighter, warm tone
                    footerLinkColor: '#F5B041', // Gold/Yellow accent
                    heroGradientFrom: '#E67E22',
                    heroGradientTo: '#D35400',
                    sectionBgPrimary: '#FFF8DC',
                    sectionBgSecondary: '#F5DEB3',
                    heroDefaultImage: 'https://placehold.co/1920x1080/E74C3C/F4D03F?text=SUNSET+VIBES',
                    productSectionTitle: 'Warmth & Style Products',
                    categorySectionTitle: 'Golden Hour Collections',
                    // Standard order for this design
                    sectionOrder: ['hero', 'products', 'categories', 'about', 'newsletter', 'contact'],
                    defaultMetaDescription: 'Adoptez la chaleur du coucher de soleil avec la collection Warm Sunset de Sheeka Store. Des vêtements confortables et élégants.'
                },
                {
                    name: 'Midnight Elegance',
                    layoutType: 'default',
                    primaryColor: '#2C3E50', // Dark Charcoal Blue
                    secondaryColor: '#1A252F', // Very Dark Blue-Grey
                    tertiaryColor: '#F4F6F7', // Very Light Grey/Off-White
                    generalTextColor: '#34495E', // Slightly Lighter Dark Blue-Grey
                    footerBgColor: '#1A252F',
                    footerTextColor: '#BDC3C7', // Light Grey
                    footerLinkColor: '#FFD700', // Gold accent
                    heroGradientFrom: '#2C3E50',
                    heroGradientTo: '#1A252F',
                    sectionBgPrimary: '#F4F6F7',
                    sectionBgSecondary: '#EAECEF',
                    heroDefaultImage: 'https://placehold.co/1920x1080/2C3E50/FFD700?text=MIDNIGHT+ELEGANCE',
                    productSectionTitle: 'Exquisite Selections',
                    categorySectionTitle: 'Discover Our Boutiques',
                    sectionOrder: ['hero', 'about', 'products', 'categories', 'newsletter', 'contact'],
                    defaultMetaDescription: 'Découvrez l\'élégance intemporelle et le luxe discret chez Sheeka Store. Des collections raffinées pour les sociétés distinguées.'
                },
                {
                    name: 'Avant-Garde Chic',
                    layoutType: 'default', // Keeping default layout for hero, but colors and image will make it distinct
                    primaryColor: '#004D40', // Dark Teal
                    secondaryColor: '#FF4081', // Vibrant Pink/Fuchsia
                    tertiaryColor: '#F5F5F5', // Off-White
                    generalTextColor: '#212121', // Dark Grey
                    footerBgColor: '#002B24', // Even Darker Teal
                    footerTextColor: '#B2DFDB', // Light Teal
                    footerLinkColor: '#FFD700', // Gold
                    heroGradientFrom: '#004D40',
                    heroGradientTo: '#FF4081',
                    sectionBgPrimary: '#F5F5F5',
                    sectionBgSecondary: '#EEEEEE',
                    heroDefaultImage: 'https://placehold.co/1920x1080/004D40/FF4081?text=AVANT-GARDE+CHIC',
                    productSectionTitle: 'Curated Masterpieces',
                    categorySectionTitle: 'Explore Our Collections',
                    sectionOrder: ['hero', 'newsletter', 'categories', 'products', 'about', 'contact'],
                    defaultMetaDescription: 'Découvrez l\'avant-garde de la mode chez Sheeka Store. Des créations audacieuses et uniques pour une expression de style inégalée.'
                },
                {
                    name: 'Opulent Renaissance',
                    layoutType: 'default',
                    primaryColor: '#8B0000', // Dark Red / Maroon
                    secondaryColor: '#B8860B', // Dark Goldenrod
                    tertiaryColor: '#FDF5E6', // Old Lace / Cream
                    generalTextColor: '#4A2323', // Dark Brownish Red
                    footerBgColor: '#4A2323',
                    footerTextColor: '#F0E68C', // Khaki / Pale Gold
                    footerLinkColor: '#FFD700', // Gold
                    heroGradientFrom: '#8B0000',
                    heroGradientTo: '#B8860B',
                    sectionBgPrimary: '#FDF5E6',
                    sectionBgSecondary: '#F5DEB3', // Moccasin / Lighter Cream
                    heroDefaultImage: 'https://placehold.co/1920x1080/8B0000/FFD700?text=OPULENT+RENAISSANCE',
                    productSectionTitle: 'Treasures of the Collection',
                    categorySectionTitle: 'Grand Collections',
                    sectionOrder: ['hero', 'about', 'categories', 'products', 'newsletter', 'contact'],
                    defaultMetaDescription: 'Plongez dans le luxe et la grandeur avec la collection Opulent Renaissance de Sheeka Store. Des pièces d\'une richesse inégalée pour un style majestueux.'
                },
                {
                    name: 'Modern Green & Black',
                    layoutType: 'default',
                    primaryColor: '#004D40', // Dark Teal/Forest Green
                    secondaryColor: '#212121', // Very Dark Grey/Near Black
                    tertiaryColor: '#F5F5F5', // Off-White
                    generalTextColor: '#212121', // Dark Grey/Black
                    footerBgColor: '#002B24', // Even Darker Teal/Blackish Green
                    footerTextColor: '#B2DFDB', // Light Teal/Mint
                    footerLinkColor: '#FFD700', // Gold accent
                    heroGradientFrom: '#004D40',
                    heroGradientTo: '#212121',
                    sectionBgPrimary: '#F5F5F5',
                    sectionBgSecondary: '#EEEEEE', // Slightly darker grey
                    heroDefaultImage: 'https://placehold.co/1920x1080/004D40/F5F5F5?text=MODERN+GREEN+BLACK',
                    productSectionTitle: 'Our Latest Styles',
                    categorySectionTitle: 'Shop by Collection',
                    sectionOrder: ['hero', 'products', 'categories', 'about', 'newsletter', 'contact'],
                    defaultMetaDescription: 'Découvrez l\'élégance moderne avec la collection Vert & Noir de Sheeka Store. Style intemporel et chic.'
                }
            ];

            // Helper function to build absolute image/video URLs
            function buildAbsoluteUrl(url, fallbackText = 'No Image') {
                if (!url) {
                    if (fallbackText.includes('Image')) {
                        return `https://placehold.co/600x400/EEEEEE/333333?text=${encodeURIComponent(fallbackText)}`;
                    } else if (fallbackText.includes('Video')) {
                        return ''; // Or a default video URL if you have one
                    }
                }
                if (url && url.startsWith('http')) return url; // Already absolute
                return `${BASE_URL}${url}`;
            }

            // Function to display a message to the user
            function showMessage(type, message) {
                const box = type === 'success' ? successMessageBox : errorMessageBox;
                box.textContent = message;
                box.classList.remove('hidden');
                setTimeout(() => {
                    box.classList.add('hidden');
                }, 3000); // Hide after 3 seconds
            }

            // Function to apply a specific design based on index
            function applyDesign(designIndex, siteConfig) {
                const root = document.documentElement;
                const chosenDesign = designConfigurations[designIndex];

                if (!chosenDesign) {
                    console.warn(`Design index ${designIndex} not found. Applying default design (index 0).`);
                    applyDesign(0, siteConfig); // Fallback to default design
                    return;
                }

                currentActiveDesign = chosenDesign; // Store the active design globally

                // Apply colors
                root.style.setProperty('--primary-color', chosenDesign.primaryColor);
                root.style.setProperty('--secondary-color', chosenDesign.secondaryColor);
                root.style.setProperty('--tertiary-color', chosenDesign.tertiaryColor);
                root.style.setProperty('--general-text-color', chosenDesign.generalTextColor);
                root.style.setProperty('--footer-bg-color', chosenDesign.footerBgColor);
                root.style.setProperty('--footer-text-color', chosenDesign.footerTextColor);
                root.style.setProperty('--footer-link-color', chosenDesign.footerLinkColor);
                root.style.setProperty('--hero-gradient-from', chosenDesign.heroGradientFrom);
                root.style.setProperty('--hero-gradient-to', chosenDesign.heroGradientTo);
                root.style.setProperty('--section-bg-primary', chosenDesign.sectionBgPrimary);
                root.style.setProperty('--section-bg-secondary', chosenDesign.sectionBgSecondary);

                // Reset hero background elements
                heroBackground.style.backgroundImage = 'none'; // Clear any image background
                heroVideoBackground.classList.add('hidden'); // Hide video
                heroVideoBackground.pause(); // Pause any playing video
                
                // Apply dynamic hero content based on layoutType
                heroDynamicContent.innerHTML = ''; // Clear previous content

                if (chosenDesign.layoutType === 'default') {
                    heroDynamicContent.innerHTML = `
                        <h1 class="text-5xl md:text-7xl font-extrabold mb-6 leading-tight animate-fade-in">
                            <span id="hero-site-name"></span>: <span class="block text-[#E6B89C]" id="hero-slogan"></span>
                        </h1>
                        <p class="text-lg md:text-xl mb-10 opacity-0 animate-slide-in-right" style="animation-delay: 0.5s;">
                            Discover the latest trends and timeless classics that define sophistication and comfort.
                        </p>
                        <a href="#products" class="inline-block bg-white text-primary hover:bg-gray-100 px-10 py-4 rounded-full text-lg font-semibold shadow-xl transition duration-300 transform hover:scale-105 opacity-0 animate-slide-in-left" aria-label="Shop Now">
                            Shop Now
                        </a>
                    `;
                    // Manage hero image carousel for default layout
                    if (promoImagesArray.length === 0) {
                        heroBackground.style.backgroundImage = `url('${chosenDesign.heroDefaultImage}')`;
                    } else {
                        changeHeroImage(); // Start carousel
                    }
                    heroBackground.classList.remove('hidden'); // Show image background
                    heroMediaContainer.classList.remove('hidden'); // Ensure media container is visible
                } else if (chosenDesign.layoutType === 'banner') {
                    heroDynamicContent.innerHTML = `
                        <h1 class="text-5xl md:text-7xl font-extrabold mb-6 leading-tight animate-fade-in">${siteConfig.bannerHeadline || chosenDesign.defaultBannerHeadline}</h1>
                        <p class="text-lg md:text-xl mb-10 opacity-0 animate-slide-in-right" style="animation-delay: 0.5s;">Explore our curated collections designed just for you.</p>
                        <a href="#products" class="inline-block bg-white text-primary hover:bg-gray-100 px-10 py-4 rounded-full text-lg font-semibold shadow-xl transition duration-300 transform hover:scale-105 opacity-0 animate-slide-in-left" aria-label="View Collections">
                            View Collections
                        </a>
                    `;
                    // Manage hero image carousel for banner layout
                    if (promoImagesArray.length === 0) {
                        heroBackground.style.backgroundImage = `url('${chosenDesign.heroDefaultImage}')`;
                    } else {
                        changeHeroImage(); // Start carousel
                    }
                    heroBackground.classList.remove('hidden'); // Show image background
                    heroMediaContainer.classList.remove('hidden'); // Ensure media container is visible
                } else if (chosenDesign.layoutType === 'video') { // This block is now effectively for Design 2 if changed back, or other future video designs
                    const videoUrl = buildAbsoluteUrl(siteConfig.heroVideoUrl || chosenDesign.defaultHeroVideoUrl, 'No Video URL');
                    if (videoUrl) {
                        heroVideoSource.src = videoUrl;
                        heroVideoBackground.load();
                        heroVideoBackground.play();
                        heroVideoBackground.classList.remove('hidden');
                        heroMediaContainer.classList.remove('hidden'); // Ensure media container is visible
                        heroBackground.classList.add('hidden'); // Hide image background
                    } else {
                        console.warn("No valid video URL found for video layout. Falling back to default image.");
                        heroBackground.style.backgroundImage = `url('${chosenDesign.heroDefaultImage}')`;
                        heroBackground.classList.remove('hidden'); // Show image background
                        heroMediaContainer.classList.remove('hidden'); // Ensure media container is visible
                        heroVideoBackground.classList.add('hidden'); // Ensure video is hidden
                    }

                    heroDynamicContent.innerHTML = `
                        <h1 class="text-5xl md:text-7xl font-extrabold mb-6 leading-tight animate-fade-in">
                            Immerse Yourself: Dynamic Fashion Awaits.
                        </h1>
                        <p class="text-lg md:text-xl mb-10 opacity-0 animate-slide-in-right" style="animation-delay: 0.5s;">
                            Experience our latest arrivals in stunning detail.
                        </p>
                        <a href="#products" class="inline-block bg-white text-primary hover:bg-gray-100 px-10 py-4 rounded-full text-lg font-semibold shadow-xl transition duration-300 transform hover:scale-105 opacity-0 animate-slide-in-left" aria-label="Discover More">
                            Discover More
                        </a>
                    `;
                }

                // Update section titles based on the chosen design
                if (productsSectionTitle) productsSectionTitle.textContent = chosenDesign.productSectionTitle;
                if (categoriesSectionTitle) categoriesSectionTitle.textContent = chosenDesign.categorySectionTitle;

                // Update common text elements (these IDs might be recreated by innerHTML, so re-get them if needed)
                const currentHeroSiteName = document.getElementById('hero-site-name');
                const currentHeroSlogan = document.getElementById('hero-slogan');

                if (pageTitle) pageTitle.textContent = `${siteConfig.siteName} - ${siteConfig.slogan}`;
                // Set meta description dynamically
                if (metaDescription) metaDescription.content = siteConfig.metaDescription || chosenDesign.defaultMetaDescription;

                if (siteNameHeader) siteNameHeader.textContent = siteConfig.siteName;
                // Re-populate hero specific dynamic text if elements exist (relevant for 'default' layout after innerHTML clears it)
                if (currentHeroSiteName) currentHeroSiteName.textContent = siteConfig.siteName;
                if (currentHeroSlogan) currentHeroSlogan.textContent = siteConfig.slogan;
                
                if (newsletterSiteName) newsletterSiteName.textContent = siteConfig.siteName;
                if (footerSiteName) footerSiteName.textContent = siteConfig.siteName;
                if (footerSlogan) footerSlogan.textContent = siteConfig.slogan; 
                if (copyrightSiteName) copyrightSiteName.textContent = siteConfig.siteName;

                // Reorder sections based on sectionOrder array
                const sectionsToReorder = {};
                chosenDesign.sectionOrder.forEach(sectionId => {
                    const sectionElement = document.getElementById(sectionId);
                    if (sectionElement) {
                        sectionsToReorder[sectionId] = sectionElement;
                    } else {
                        console.warn(`Section with ID '${sectionId}' not found in HTML.`);
                    }
                });

                // Clear current content in main and append in new order
                mainContentContainer.innerHTML = ''; // Clear all existing sections

                chosenDesign.sectionOrder.forEach(sectionId => {
                    const sectionElement = sectionsToReorder[sectionId];
                    if (sectionElement) {
                        mainContentContainer.appendChild(sectionElement);
                    }
                });
            }

            // Function to fetch and apply site configuration
            async function fetchSiteConfig() {
                try {
                    const response = await fetch(`${BASE_URL}/api/site-config`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const config = await response.json();
                    // console.log("Fetched Site Config:", config); // Removed console.log

                    // Determine the design index, fallback to 0 if invalid
                    const designIndex = (config.currentDataIndex !== undefined && config.currentDataIndex >= 0 && config.currentDataIndex < designConfigurations.length)
                        ? config.currentDataIndex
                        : 0; 
                    
                    // Apply the chosen design and populate relevant text fields
                    applyDesign(designIndex, config);

                    // Apply About Us text (safe as it's not in hero-dynamic-content)
                    if (aboutUsTextElem) {
                        aboutUsTextElem.innerHTML = config.aboutUsText.replace(/\n/g, '<br>');
                    }

                    // Apply About Us Image (safe as it's not in hero-dynamic-content)
                    if (aboutUsImageElem) {
                        aboutUsImageElem.src = buildAbsoluteUrl(config.aboutUsImageUrl || 'https://placehold.co/800x600/6A5ACD/FFFFFF?text=About+Us');
                        aboutUsImageElem.alt = `À propos de Sheeka Store - ${config.siteName}`; // More descriptive alt text
                    }

                    // Apply social media links
                    if (socialMediaLinksContainer) {
                        socialMediaLinksContainer.innerHTML = '';
                        if (config.socialMediaLinks && Array.isArray(config.socialMediaLinks)) {
                            config.socialMediaLinks.forEach(link => {
                                const a = document.createElement('a');
                                a.href = link.url;
                                a.target = '_blank';
                                a.rel = 'noopener noreferrer'; // Security for external links
                                // Use platform for accessible name for social media links
                                a.setAttribute('aria-label', `Visit us on ${link.platform}`);
                                a.innerHTML = `<i class="${link.iconClass} w-6 h-6"></i>`;
                                socialMediaLinksContainer.appendChild(a);
                            });
                        }
                    }

                } catch (error) {
                    console.error("Error fetching site configuration:", error);
                    // Fallback to default design and content on error
                    const defaultSiteConfig = { 
                        siteName: 'Sheeka', 
                        slogan: 'Elevate Your Style', 
                        aboutUsText: `At <strong class="text-primary">Sheeka</strong>, we believe that fashion is a powerful form of self-expression. Our brand is dedicated to providing high-quality, stylish, and comfortable clothing that empowers you to express your unique personality.

From conceptualization to creation, every piece is crafted with meticulous attention to detail and a passion for design. We're committed to sustainable practices and ethical production, ensuring that your style choices make a positive impact. Join the Sheeka family and redefine your wardrobe.`, 
                        aboutUsImageUrl: 'https://placehold.co/800x600/6A5ACD/FFFFFF?text=About+Us',
                        bannerHeadline: 'Welcome to our Collection', // Fallback for banner
                        heroVideoUrl: 'https://www.w3schools.com/tags/movie.mp4', // Fallback for video
                        socialMediaLinks: [ // Fallback social links
                            { url: '#', iconClass: 'fab fa-facebook', platform: 'Facebook' },
                            { url: '#', iconClass: 'fab fa-instagram', platform: 'Instagram' },
                            { url: '#', iconClass: 'fab fa-twitter', platform: 'Twitter' }
                        ],
                        metaDescription: 'Découvrez les dernières tendances et les classiques intemporels chez Sheeka Store. Élégance et confort garantis.'
                    };
                    // Apply the new "Modern Green & Black" design by default if there's an error fetching config
                    applyDesign(9, defaultSiteConfig); // Changed to index 9 for the new theme
                    console.warn("Using default site configuration due to fetch error.");
                }
            }

            // Function to fetch and display products
            async function fetchProducts() {
                // Clear any previous content to ensure fresh data is loaded
                productListContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">Loading products...</p>';

                try {
                    const response = await fetch(`${BASE_URL}/products`);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const products = await response.json();
                    productListContainer.innerHTML = ''; // Clear loading message

                    if (products.length === 0) {
                        productListContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">No products available right now.</p>';
                        return;
                    }

                    products.forEach(product => {
                        const imageUrl = product.images && product.images.length > 0 
                            ? product.images[0] 
                            : 'https://placehold.co/600x400/EEEEEE/333333?text=No+Image';

                        const originalPrice = parseFloat(product.price).toFixed(2);
                        const salePrice = product.salePrice ? parseFloat(product.salePrice).toFixed(2) : null;

                        const priceDisplay = salePrice ? 
                            `<span class="text-xl text-gray-500 line-through mr-2">${originalPrice} DA</span>
                            <span class="text-3xl font-extrabold text-primary">${salePrice} DA</span>` :
                            `<span class="text-3xl font-extrabold text-primary">${originalPrice} DA</span>`;

                        const productCard = document.createElement('div');
                        productCard.className = 'bg-white rounded-2xl shadow-xl overflow-hidden transform transition duration-300 hover:scale-102 hover:shadow-2xl';
                        productCard.innerHTML = `
                            <a href="product-details.html?id=${product._id}" class="block">
                                <img src="${buildAbsoluteUrl(imageUrl, 'Image Error')}" alt="Image du produit ${product.name}" class="w-full h-72 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/EEEEEE/333333?text=Image+Error';" loading="lazy" width="600" height="400">
                                <div class="p-6">
                                    <h3 class="text-2xl font-bold mb-2 text-general">${product.name}</h3>
                                    <p class="text-gray-600 mb-4">${product.description?.substring(0, 100) ?? ''}${product.description?.length > 100 ? '...' : ''}</p>
                                    <div class="flex flex-col items-center justify-center mt-4">
                                        <div class="mb-4">
                                            ${priceDisplay}
                                        </div>
                                        <button class="bg-primary text-white px-8 py-3 rounded-full font-semibold hover:bg-secondary transition duration-300 transform hover:scale-105 w-full" aria-label="Order Now for ${product.name}">
                                            اطلب الآن
                                        </button>
                                    </div>
                                </div>
                            </a>
                        `;
                        productListContainer.appendChild(productCard);
                    });

                } catch (error) {
                    console.error("Error fetching products:", error);
                    productListContainer.innerHTML = '<p class="col-span-full text-center text-red-500">Failed to load products.</p>';
                }
            }


            // Function to fetch and display categories (collections)
            async function fetchCollections() {
                // Clear any previous content to ensure fresh data is loaded
                categoryListContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">Loading categories...</p>';

                try {
                    const response = await fetch(`${BASE_URL}/products/collections`); 
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const collections = await response.json();

                    categoryListContainer.innerHTML = ''; // Clear loading message

                    if (collections.length === 0) {
                        categoryListContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">No collections available right now. Please check back later!</p>';
                        return;
                    }

                    collections.forEach(collection => {
                        const categoryCard = document.createElement('div');
                        categoryCard.className = 'relative bg-white rounded-xl shadow-lg overflow-hidden group';
                        
                        const thumbnailUrl = buildAbsoluteUrl(collection.thumbnailUrl || null, 'Image Error');
                        const collectionName = collection.name || 'Untitled Collection';

                        // Updated href to point to collection-details.html with ID
                        categoryCard.innerHTML = `
                            <a href="collection-details.html?id=${collection._id}" class="block">
                                <!-- Added explicit width/height and more descriptive alt text -->
                                <img src="${thumbnailUrl}" alt="Image de la collection ${collectionName}" class="w-full h-48 object-cover group-hover:scale-110 transition duration-500 ease-in-out" onerror="this.onerror=null;this.src='https://placehold.co/600x400/DDA0DD/FFFFFF?text=Image+Error';" loading="lazy" width="400" height="300">
                                <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    <span class="text-white text-2xl font-bold">${collectionName}</span>
                                </div>
                            </a>
                        `;
                        categoryListContainer.appendChild(categoryCard);
                    });
                } catch (error) {
                    console.error("Error fetching collections:", error);
                    categoryListContainer.innerHTML = '<p class="col-span-full text-center text-red-500">Failed to load categories. Please try again later.</p>';
                }
            }

            // Function to change the hero image for carousel
            function changeHeroImage() {
                if (promoImagesArray.length > 0 && currentActiveDesign && currentActiveDesign.layoutType !== 'video') {
                    const imageUrl = buildAbsoluteUrl(promoImagesArray[currentPromoImageIndex], 'No Image');
                    heroBackground.style.backgroundImage = `url('${imageUrl}')`;
                    currentPromoImageIndex = (currentPromoImageIndex + 1) % promoImagesArray.length;
                }
            }

            // Function to fetch and set hero images for carousel
            async function fetchHeroImagesForCarousel() {
                try {
                    // console.log("Attempting to fetch promo images for carousel from:", `${BASE_URL}/products/promo`); // Removed console.log
                    const response = await fetch(`${BASE_URL}/products/promo`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const fetchedImages = await response.json();
                    // console.log("Fetched promo images (raw data) for carousel:", fetchedImages); // Removed console.log

                    if (fetchedImages.length > 0) {
                        promoImagesArray = fetchedImages; // Store fetched images
                        currentPromoImageIndex = 0; // Reset index

                        // Clear any existing interval before starting a new one
                        if (heroImageInterval) {
                            clearInterval(heroImageInterval);
                        }

                        // Display the first image immediately, only if current design is not video
                        if (currentActiveDesign && currentActiveDesign.layoutType !== 'video') {
                           changeHeroImage(); // Set the first image
                            if (promoImagesArray.length > 1) {
                                heroImageInterval = setInterval(changeHeroImage, 5000); // Start carousel if more than one image
                            }
                        }
                    } else {
                        console.warn("No promo images found for the hero section carousel. Using default from current design if applicable.");
                    }
                } catch (error) {
                    console.error("Error fetching hero images for carousel:", error);
                }
            }

            // Contact Form Submission
            const contactForm = document.getElementById('contact-form');
            if (contactForm) {
                contactForm.addEventListener('submit', async (e) => {
                    e.preventDefault(); // Prevent default form submission

                    const senderName = document.getElementById('name').value;
                    const senderEmail = document.getElementById('email').value;
                    const message = document.getElementById('message').value;

                    if (!senderName || !senderEmail || !message) {
                        showMessage('error', 'Please fill in all contact form fields (Name, Email, Message).');
                        return;
                    }

                    try {
                        const response = await fetch(`${BASE_URL}/api/emails`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                senderName: senderName,
                                senderEmail: senderEmail,
                                message: message
                            }),
                        });

                        const result = await response.json();

                        if (response.ok) { // Check for 2xx status codes
                            showMessage('success', result.message || 'Your message has been sent successfully!');
                            contactForm.reset(); // Clear the form
                        } else {
                            // If backend responds with a non-2xx status (e.g., 404, 500)
                            showMessage('error', `Failed to send message: ${result.message || 'Unknown error'}`);
                            console.error('Backend error response:', result);
                        }
                    } catch (error) {
                        // This catch block handles network errors (e.g., server down, CORS preflight failed)
                        console.error('Network error during contact message submission:', error);
                        showMessage('error', `An error occurred while sending your message: ${error.message}`);
                    }
                });
            }

            // --- Cookie Consent Logic ---
            function setCookie(name, value, days) {
                let expires = "";
                if (days) {
                    const date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = "; expires=" + date.toUTCString();
                }
                document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
            }

            function getCookie(name) {
                const nameEQ = name + "=";
                const ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }

            function showCookieConsent() {
                // Only show if the user hasn't accepted cookies previously
                if (!getCookie('cookies_accepted')) {
                    cookieConsentBar.classList.remove('translate-y-full');
                    cookieConsentBar.classList.add('translate-y-0');
                }
            }

            function hideCookieConsent() {
                cookieConsentBar.classList.remove('translate-y-0');
                cookieConsentBar.classList.add('translate-y-full');
                // Use a timeout to hide after transition
                setTimeout(() => {
                    cookieConsentBar.classList.add('hidden');
                }, 500); // Match CSS transition duration
            }

            // Event listeners for cookie consent buttons
            if (acceptCookiesButton) {
                acceptCookiesButton.addEventListener('click', () => {
                    setCookie('cookies_accepted', 'true', 365); // Consent for 1 year
                    hideCookieConsent();
                    showMessage('success', 'Cookies accepted. Thank you!');
                });
            }

            if (declineCookiesButton) {
                declineCookiesButton.addEventListener('click', () => {
                    // For simplicity, we just hide it. If more strict decline behavior is needed (e.g., disabling analytics),
                    // additional logic would go here.
                    hideCookieConsent();
                    showMessage('info', 'Cookies declined. Some features might be limited.');
                });
            }


            // Initial data fetching calls - these will run as soon as DOM is ready
            fetchSiteConfig(); 
            fetchProducts(); 
            fetchCollections(); 
            fetchHeroImagesForCarousel();
            
            // Show cookie consent bar after all other content is loaded
            showCookieConsent();


            // Smooth scrolling for navigation links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    // Get the target section ID from the href
                    const targetId = this.getAttribute('href').substring(1); 
                    const targetElement = document.getElementById(targetId);

                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Mobile menu toggle
            function openMobileMenu() {
                mobileMenu.classList.remove('translate-x-full');
                mobileMenu.classList.add('translate-x-0');
                mobileMenu.classList.remove('hidden'); // Ensure it's visible for transition
                mobileMenuOverlay.classList.remove('hidden');
            }

            function closeMobileMenu() {
                mobileMenu.classList.remove('translate-x-0');
                mobileMenu.classList.add('translate-x-full');
                mobileMenuOverlay.classList.add('hidden');
                // Use a timeout to hide after transition
                setTimeout(() => {
                    mobileMenu.classList.add('hidden');
                }, 300);
            }

            mobileMenuButton.addEventListener('click', openMobileMenu);
            closeMobileMenuButton.addEventListener('click', closeMobileMenu);
            mobileMenuOverlay.addEventListener('click', closeMobileMenu); // Close when clicking outside menu

            // Function to add 'is-visible' class for fade-in effect on scroll
            const observerOptions = {
                root: null, // viewport
                rootMargin: '0px',
                threshold: 0.1 // 10% of section visible
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                    }
                });
            }, observerOptions);

            fadeInSections.forEach(section => {
                observer.observe(section);
            });
        });
    </script>
</body>
</html>
